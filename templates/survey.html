<!DOCTYPE html>
<html>
<head>
    <title>GPT Response</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <style>
        .progress-container {
            display: none;
            text-align: center;
        }

        .progress-container.active {
            display: block;
        }

        .progress-loading {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top-color: #007bff;
            border-radius: 50%;
            animation: indeterminateAnimation 1s infinite linear;
            transform-origin: 0% 50%;
        }

        

        .loading-container {
            display: none;
            text-align: center;
        }

        .loading-container.active {
            display: block;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top-color: #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes indeterminateAnimation {
            0% {
            transform:  translateX(0) scaleX(0);
            }
            40% {
            transform:  translateX(0) scaleX(0.4);
            }
            100% {
            transform:  translateX(100%) scaleX(0.5);
            }
        }
    </style>

</head>
<body>
    <nav class="navbar navbar-dark bg-info">
        <input id="user_id" name="user_id" type="text" value="{{user_id}}" hidden>
        <a class="navbar-brand" href="#">GPT</a>
        <div>
            <button class="btn btn-warning" id="btnResetChoices" onclick="resetRadBtnChoices()">Reset Choices</button>
           
            <a href="/done" class="btn btn-secondary float-right" id="done-button">Done</a>
        </div>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        
       
    </nav>

    <form action="/survey" method="POST">
   
    <div class="row">
        <div class="col-sm-4">
            <div class="jumbotron">Assertion No.: 
               {{data.statement_id}}
                <input id="st-num" type="text" name="st_num" value="{{data.statement_id}}" hidden>
                
                {% autoescape false %}
                <p id="assertion-text">{{ data.statement_text }}</p>
                {% endautoescape %}
                
            </div>
                
        </div>
        <div class="col-sm-8">
            <div class="container">
                <div class="card">
                   
                    <div class="card-body">
                        
                        <div class="loading-container" id="loading-container">
                            <div class="loading-spinner"></div>
                            <div>Loading...</div>
                        </div>

                        <div class="row">
                            <div class="col-md-8">
                                Question:
                            
                            {% autoescape false %}
                                <p id="question-text" style="font-size:16px">{{data.question}}</p>
                            {% endautoescape %}
                            </div>
                            <div class="col-md-4">
                                <label for="">Rank1: </label><input type="text"  size="6" disabled>
                                <label for="">Rank2: </label><input type="text" size="6" disabled>
                                <label for="">Rank3: </label><input type="text" size="6" disabled>
                                <label for="">Rank4: </label><input type="text" size="6" disabled>
                            </div>

                            
                        </div>
        
                        <div >
                            <div id="ans-styles">
                                
                            </div>
                            <div id="answer-options">
                                
                                    <table class="table table-condensed table-hover">
            
                                        <tr>
                                            <td>[1]</td>
                                            <td>
                                                {% autoescape false %}
                                                    <p id="question-text" style="font-size:16px">{{data.ans_style_1}}</p>
                                                {% endautoescape %}
                                                
                                            </td>
                                            
                                            <td>
                                                {% for feedback in range(1, 5) %}
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="radio" name="style1_btn" value="{{ feedback }}" id="style1_btn_id">
                                                    <label class="form-check-label" for="statement{{ loop.index }}_feedback{{ feedback }}">{{ feedback }}</label>
                                                
                                                </div>
                                                {% endfor %}
                                            </td>
                                        </tr>

                                        <tr>
                                            <td>[2]</td>
                                            <td>
                                                {% autoescape false %}
                                                <p>{{data.ans_style_2}}</p>
                                                {% endautoescape %}
                                            </td>
                                            
                                            <td>
                                                {% for feedback in range(1, 5) %}
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="radio" name="style2_btn" value="{{ feedback }}" id="style2_btn_id" >
                                                    <label class="form-check-label" for="statement{{ loop.index }}_feedback{{ feedback }}">{{ feedback }}</label>
                                                
                                                </div>
                                                {% endfor %}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>[3]</td>
                                            <td>
                                                {% autoescape false %}
                                                <p>{{data.ans_style_3}}</p>
                                                {% endautoescape %}
                                            </td>
                                            
                                            <td>
                                                {% for feedback in range(1, 5) %}
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="radio" name="style3_btn" value="{{ feedback }}" id="style3_btn_id" >
                                                    <label class="form-check-label" for="statement{{ loop.index }}_feedback{{ feedback }}">{{ feedback }}</label>
                                                
                                                </div>
                                                {% endfor %}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>[4]</td>
                                            <td>
                                                {% autoescape false %}
                                                <p>{{data.ans_style_4}}</p>
                                                {% endautoescape %}
                                            </td>
                                            
                                            <td>
                                                {% for feedback in range(1, 5) %}
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="radio" name="style4_btn" value="{{ feedback }}" id="style4_btn_id">
                                                    <label class="form-check-label" for="statement{{ loop.index }}_feedback{{ feedback }}">{{ feedback }}</label>
                                                
                                                </div>
                                                {% endfor %}
                                            </td>
                                        </tr>
                                       
                                    </table>
                                    
                              
                            </div>
                        </div>
                    </div>
        
                    <div class="card-footer">
                        <div>
                                  
                                <button class="btn btn-primary" id="next-button" type="submit" onclick="showLoading()">Next</button>
                                
                                <div class="progress-container" id="progress-container">
                                    <div class="progress-loading"></div>
                                    <div>Saving...</div>
                                </div>
                        
                            
                        </div>
                        
                    </div>
                 
                </div>
        
            </div>
        </div>
    </div>

    </form>



    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {

            document.getElementById("btnResetChoices").addEventListener("click", resetRadBtnChoices);

            console.log("Survey Page is loaded")

            var options = []

            $("#next-button").click(function(event){
               

                if( $( "input[name='style1_btn']:checked" ).length == 0  ||  $( "input[name='style2_btn']:checked" ).length == 0  ||  $( "input[name='style3_btn']:checked" ).length == 0 || $( "input[name='style4_btn']:checked" ).length == 0)
                {
                    alert("Please check that you have assigned rank for each option!")
                    event.preventDefault();
                    return
                }   

            });
            

            $('input[type=radio][name=style1_btn]').change(function() {
                myvar = $('input[name="style1_btn"]:checked').val();
                console.log(myvar)

                if($.inArray(myvar, options) >= 0){
                    alert("Rank has been assigned! Make sure to have unique rank for each option. Click reset button to restart selection.")
                    $('input[name="style1_btn"]:checked').prop('checked', false); 
                }
                else{
                    options.push(myvar)
                    console.log(options)
                }
            });
            $('input[type=radio][name=style2_btn]').change(function() {
                myvar = $('input[name="style2_btn"]:checked').val();
                console.log(myvar)

                if($.inArray(myvar, options) >= 0){
                    alert("Rank has been assigned! Make sure to have unique rank for each option. Click reset button to restart selection.")
                    $('input[name="style2_btn"]:checked').prop('checked', false); 
                }
                else{
                    options.push(myvar)
                    console.log(options)
                }
            });
            $('input[type=radio][name=style3_btn]').change(function() {
                myvar = $('input[name="style3_btn"]:checked').val();
                console.log(myvar)

                if($.inArray(myvar, options) >= 0){
                    alert("Rank has been assigned! Make sure to have unique rank for each option. Click reset button to restart selection.")
                    $('input[name="style3_btn"]:checked').prop('checked', false); 
                }
                else{
                    options.push(myvar)
                    console.log(options)
                }
            });
            $('input[type=radio][name=style4_btn]').change(function() {
                myvar = $('input[name="style4_btn"]:checked').val();
                console.log(myvar)

                if($.inArray(myvar, options) >= 0){
                    alert("Rank has been assigned! Make sure to have unique rank for each option. Click reset button to restart selection.")
                    $('input[name="style4_btn"]:checked').prop('checked', false); 
                }
                else{
                    options.push(myvar)
                    console.log(options)
                }
            });

            function resetRadBtnChoices(){
               
                $('input[name="style1_btn"]:checked').prop('checked', false); 
                $('input[name="style2_btn"]:checked').prop('checked', false); 
                $('input[name="style3_btn"]:checked').prop('checked', false); 
                $('input[name="style4_btn"]:checked').prop('checked', false);   
                
                while(options.length > 0) {
                    options.pop();
                }
        
            }

            function showLoading() {
            $("#loading-container").addClass("active");
            }

            function hideLoading() {
                $("#loading-container").removeClass("active");
            }

            function showSaving() {
                $("#progress-container").addClass("active");
            }

            function hideSaving() {
                $("#progress-container").removeClass("active");
            }

            
        });
    </script>
</body>
</html>
